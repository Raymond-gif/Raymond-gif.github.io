---
layout: compress
---

{% include base_path %}

<!doctype html>
<html lang="{{ site.locale | slice: 0,2 }}" class="no-js"{% if site.site_theme == "dark" %} data-theme="dark"{% endif %}>
  <head>
    {% include head.html %}
    {% include head/custom.html %}
  </head>

  <body>

    {% include browser-upgrade.html %}
    {% include masthead.html %}

    {{ content }}

    <div class="page__footer">
      <footer>
        {% include footer/custom.html %}
        {% include footer.html %}
      </footer>
    </div>

    {% include scripts.html %}

    {% raw %}
    <script>
        document.addEventListener("DOMContentLoaded", () => {
          const sections = document.querySelectorAll("h1[id], h2[id], h3[id]");
          const navLinks = document.querySelectorAll(".sidebar__right .toc a");

          // Map href → link for quick lookup
          const linkMap = {};
          navLinks.forEach(link => {
            const hash = link.getAttribute("href").split("#").pop();
            if (hash) linkMap[hash] = link;
          });

          const sidebar = document.querySelector(".sidebar__right");

          function onScroll() {
            let currentSection = "";

            // Find the last heading above scroll position
            sections.forEach(section => {
              const sectionTop = section.getBoundingClientRect().top + window.scrollY - 120; 
              if (window.scrollY >= sectionTop) {
                currentSection = section.getAttribute("id");
              }
            });

            // Update TOC links
            Object.keys(linkMap).forEach(id => {
              linkMap[id].classList.remove("active");
            });

            if (currentSection && linkMap[currentSection]) {
              const activeLink = linkMap[currentSection];
              activeLink.classList.add("active");

              // Auto-scroll sidebar to keep active link visible
              const sidebarTop = sidebar.scrollTop;
              const sidebarHeight = sidebar.clientHeight;
              const linkOffsetTop = activeLink.offsetTop;
              const linkHeight = activeLink.offsetHeight;

              if (linkOffsetTop < sidebarTop) {
                // link is above view → scroll up
                sidebar.scrollTop = linkOffsetTop - 10;
              } else if (linkOffsetTop + linkHeight > sidebarTop + sidebarHeight) {
                // link is below view → scroll down
                sidebar.scrollTop = linkOffsetTop - sidebarHeight + linkHeight + 10;
              }
            }
          }
      // Initial highlight
      onScroll();

      // Listen to scroll events
      window.addEventListener("scroll", onScroll);
    });
    </script>
    {% endraw %}

  </body>
</html>
